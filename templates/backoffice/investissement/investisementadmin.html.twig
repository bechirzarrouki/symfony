{% extends 'base.html.twig' %}

{% block title %}Home - Purple Social{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/investisementadmin.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock %}

{% block body %}  
    {% include 'components/navbar.html.twig' %}
    {% include 'components/sidebar.html.twig' %}

    <div class="post-container">
       <!-- L'investment-box est maintenant sous create-post mais toujours dans post-container -->
	 {% for investment in investments %}
            <div class="investment-box">
                <div class="profile-section">
                    <img src="{{ asset('images/avatar.jpg') }}" alt="Profile" class="profile-img">
                    <div class="profile-info">
                        <h4>{{ investment.user.name }}</h4>
                    </div>
                    <div class="date-time">10/02/2025 - 14:30</div>
                    <div class="options-menu">
                        <i class="fas fa-ellipsis-v" onclick="toggleOptionsMenu(event)"></i>
                        <div class="options-dropdown">
                           
                            <button onclick="openDeleteModal({{ investment.id }})">Delete</button>
                        </div>
                    </div>
                </div>

                <div class="investment-content">
                    {{ investment.content }}
                </div>
            </div>

            <!-- Investment details section -->
            <div class="investment-details">
                <h3>Investment Details</h3>
                <p><strong>Project:</strong> Solar Energy for Local Businesses</p>
                <p><strong>Return on Investment:</strong> Fast</p>
                <p><strong>Date:</strong> 10/02/2025</p>
                <p><strong>Investor:</strong> Jean Dupont</p>
            </div>
        


      
        <!-- Delete Modal -->
        <div id="deleteModal{{ investment.id }}" class="modal">
            <div class="modal-content">
                <h3>Do you really want to delete this investment?</h3>
                <form action="{{ path('investment_delete_admin', { id: investment.id }) }}" method="POST">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ investment.id) }}">
                    <button type="submit" class="submit-btn">Delete</button>
                </form>
               <button class="submit-btn" onclick="closeDeleteModal('{{ investment.id }}')">Cancel</button>
            </div>
        </div>
	{% endfor %}

    <script>
        function toggleOptionsMenu(event) {
            event.stopPropagation();
            const dropdown = event.target.nextElementSibling;
            document.querySelectorAll('.options-dropdown').forEach(menu => {
                if (menu !== dropdown) menu.classList.remove('show');
            });
            dropdown.classList.toggle('show');
        }
        
        document.addEventListener('click', function () {
            document.querySelectorAll('.options-dropdown').forEach(menu => {
                menu.classList.remove('show');
            });
        });

        function openEditModal() {
            document.getElementById("editModal").style.display = "flex";
        }

        function closeEditModal() {
            document.getElementById("editModal").style.display = "none";
        }

        function saveChanges() {
            const name = document.getElementById("editName").value;
            const company = document.getElementById("editCompany").value;
            document.querySelector(".profile-info h4").textContent = name;
            document.querySelector(".profile-info p").textContent = company;
            closeEditModal();
        }

       // Ouvrir le modal de suppression
function openDeleteModal(id) {
    document.getElementById("deleteModal" + id).style.display="flex";
}

// Fermer le modal de suppression
function closeDeleteModal(id) {
    document.getElementById("deleteModal" + id).style.display = "none";
}

// Confirmer la suppression
function confirmDelete(id) {
    alert("Investissement supprimé !");
    closeDeleteModal(id);
}
                // Sélectionne tous les éléments avec la classe .investment-content
        const investmentContents = document.querySelectorAll('.investment-content');

        investmentContents.forEach(function(investmentContent) {
            console.log('test');
            // Ajoute un écouteur d'événement de clic sur chaque .investment-content
            investmentContent.addEventListener('click', function() {
                // Trouve l'élément .investment-details correspondant à l'élément cliqué
                const investmentDetails = investmentContent.nextElementSibling;

                // Bascule l'affichage de l'élément .investment-details
                if (investmentDetails.classList.contains('investment-details')) {
                    if (investmentDetails.style.display === 'none' || investmentDetails.style.display === '') {
                        investmentDetails.style.display = 'block';
                    } else {
                        investmentDetails.style.display = 'none';
                    }
                }
            });
        });
    </script>

    <style>
/* General Styles */
html, body {
    height: auto;
    min-height: 100vh;
    overflow-y: auto;
    overflow-x: hidden; /* Empêcher le défilement horizontal */
}

.post-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    max-width: 40rem;
    margin: 20px auto; /* Marge normale */
    padding: 20px;
    height: auto; /* Supprimer la hauteur fixe */
    overflow-y: visible; /* Supprimer le défilement interne */
}

.investment-box {
    width: 100%; /* Largeur fixe pour contenir le contenu */
    min-height: 120px; /* Hauteur minimale */
    /* Conserver les autres styles */
}

/* Empêcher le débordement horizontal */
* {
    box-sizing: border-box;
    max-width: 100%;
}
        .options-menu {
            position: relative;
        }

        .options-dropdown {
            display: none;
            position: absolute;
            right: 0;
            background: white;
            border: 1px solid #ccc;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            z-index: 10;
            width: 120px;
        }

        .options-dropdown.show {
            display: block;
        }

        .options-dropdown button {
            display: block;
            width: 100%;
            padding: 10px;
            border: none;
            background: none;
            cursor: pointer;
            text-align: left;
        }

        .options-dropdown button:hover {
            background: #f0f0f0;    
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
        }

        .submit-btn {
            width: 86%;
            padding: 10px;
            background-color: #53348D;
            border: 2px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
          
        }

        .submit-btn:hover {
            background-color: #432A70;
        }
    </style>
{% endblock %}
